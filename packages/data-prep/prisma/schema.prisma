generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["interactiveTransactions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Annotation {
  id                 Int          @id @default(autoincrement())
  scrollY            Int          @map("scroll_y")
  viewWidth          Int          @map("view_width")
  viewHeight         Int          @map("view_height")
  date               DateTime     @db.Timestamptz(6)
  url                String
  payload            Json
  screenshot         Bytes?
  published          Int          @default(0)
  tag                String?

  synthetic_parent_id Int?
  synthetic_parent    Annotation? @relation("SyntheticParent", fields: [synthetic_parent_id], references: [id])
  synthetic_children  Annotation[] @relation("SyntheticParent")

  ocr         Ocr[]
  Interactive Interactive[]
  ImageCrop ImageCrop[]

  @@map("annotations")
}

model Ocr {
  id         Int      @id @default(autoincrement())
  screenshot Bytes
  date       DateTime @db.Timestamptz(6)
  text       String

  // optional foreign key to Annotation
  annotationId Int?
  annotation   Annotation? @relation(fields: [annotationId], references: [id])

  // optional bounding box
  x      Float?
  y      Float?
  width  Float?
  height Float?

  @@map("ocr")
}

model Interactive {
  id           Int         @id @default(autoincrement())
  screenshot   Bytes
  label        String?
  trueId       String?     @map("true_id") @db.Uuid
  // optional foreign key to Annotation
  annotationId Int?
  annotation   Annotation? @relation(fields: [annotationId], references: [id])

  @@index([annotationId])
  @@map("interactive")
}

model ImageCrop {
  id           Int         @id @default(autoincrement())
  screenshot  Bytes
  trueId       String?     @map("true_id") @db.Uuid
  annotationId  Int?
  annotation   Annotation? @relation(fields: [annotationId], references: [id])
  aspectRatio Float

  @@index([annotationId])
  @@map("image_crop")
}
